# 链路层：链路，接入网和局域网

将运行链路层协议的任何设备均称为结点

**结点**包括主机，路由器，交换机和WiFi接入点

**链路：**沿着通信路径连接相邻结点的通信信道

为了将一个数据报从源主机传输到目的主机，数据报必须通过沿端到端路径上的各段链路传输。

## 链路层提供的服务

基本服务：将数据报通过单一通信链路从一个结点移动到相邻结点

服务：

成帧：链路层帧封装起来，一个帧由一个数据字段和若干首部字段组成

链路介入：媒体访问控制协议规定了帧在链路上传输的规则

可靠交付：当链路层协议提供

差错检测和纠正：当帧中的一个比特作为1传输时，接收方结点中的链路层引荐可能不正确地将其判断为0，反之亦然，是因为比特差错是由信号衰减和电磁噪声导致的。



## 差错检测和纠正技术

![image-20220125160503162](https://minyeon.oss-cn-beijing.aliyuncs.com/tenglingImg/image-20220125160503162.png)

检测差错的3种技术

- 奇偶校验
- 检验和方法（运输层）
- 循环冗余检测

多路访问链路和协议

点对点链路：由链路一端的单个发送方和链路另一端的单个接收方组成

广播链路：能够让多个发送和接收结点都连接到相同的，单一的，共享的广播信道上。

**多路访问协议：**即结点通过这些协议来规范它们在共享的广播信道上的传输行为

传输的帧在所有的接收方处碰撞

多路访问协议应该具有以下所希望的特性：

1. 当仅有一个结点有数据时，该结点具有Rbps的吞吐量
2. 当有M个结点要发送数据时，每个结点吞吐量为R/M bps 、 （平均来看）
3. 协议是分散的。不会因为某主结点故障而使整个系统崩溃
4. 协议是简单的

### 信道划分协议

## 两种共享信道结点之间划分广播信道带宽的技术

### 时分多路复用（TDM）

将时间划分为时间帧，并进行一步划分每个时间帧为N个时隙。然后把每个时隙分配给N个结点中的一个。

![image-20220126104056179](https://minyeon.oss-cn-beijing.aliyuncs.com/tenglingImg/image-20220126104056179.png)

消除了碰撞，每个结点在每个帧时间内得到了专用的传输速率R/Nbps

缺点：

- 结点被限制与R/N bps的平均速率，即便当它是唯一有分组要求发送的结点时
- 结点必须总是等待它在传输序列的轮次

### 频分多路复用（FDM）

![image-20220126135326687](https://minyeon.oss-cn-beijing.aliyuncs.com/tenglingImg/image-20220126135326687.png)

FDM将R bps信道划分为不同的频道，并把每个频率分配给N个结点中的一个。

FDM在单个较大的R bps 信道中创建了N个较小的R/N bps信道。

优点：

避免了碰撞，在N个结点之间公平地划分了带宽

缺点：

限制了一个结点只能使用R/N的带宽

### 码分多址

CDMA对每个结点分配一种不同的编码

### 随机接入协议

一个传输结点总是以信道的全部速率进行发送。

当有碰撞时，涉及碰撞的每个结点反复地重发他的帧，到该帧无碰撞地通过为止

重发该帧之前等待一个随机时延。涉及碰撞的每个结点独立地选择随机时延

#### 时隙ALOHA

- 所有帧由L比特组成
- 时间被划分成长度为L/R秒的时隙
- 结点只在时隙起点开始传输帧
- 结点是同步的，每个结点都知道时隙何时开始
- 如果在一个时隙中有两个或者更多个帧碰撞，则所有结点在该时隙结束之前检测到该碰撞事件

p是一个概率，即在0~1之间，在每个结点中，时隙ALOHA的操作

1. 当有新帧要发送时，它等到下一个时隙开始并在该时隙传输整个帧
2. 如果没有碰撞，该结点成功地传输它的帧，从而不需要考虑重传该帧
3. 如果有碰撞，该结点在时隙结束之前检测到这次碰撞。该结点以概率P在后续的每个时隙重传他的帧，直到无碰撞传输

这个时间以概率（1-p）出现，所有涉及碰撞的结点独立地投掷他们的硬币

#### ALOHA

以概率P传输该帧，或者以概率1-p在另一个帧时间等待

#### 载波侦听多路访问

说话之前先听   --- 载波侦听

如果与他人同时开始说话，停止说话 ---碰撞检测

具有碰撞检测的载波侦听多路访问，在分析CSMA

二进制指数后退

![image-20220126154441231](https://minyeon.oss-cn-beijing.aliyuncs.com/tenglingImg/image-20220126154441231.png)

CSMA/CD 效率



### 轮流协议

多路访问协议的两个理想特性是：1.当只有一个结点活跃时，该活跃结点具有R bps的吞吐量

2.当有M个结点活跃时，每个活跃结点的吞吐量接近R/M  bps 



## 交换局域网

### 链路层寻址和ARP

#### MAC地址

它们的适配器具有链路层地址

具有多个网络接口的主机或路由器将具有与之相关联的多个链路层地址，就像它也具有与之相关联的多个IP地址一样



链路层交换机： 不具有与它们的接口想关联的链路层地址，链路层交换机的任务是在主机与路由器之间承载数据报

地址长度6字节， 共有2的48个可能的MAC地址，通常用十六进制表示法，地址的每个字节被表示为一对十六进制数

一个公司要生成适配器时， 支付费用购买2的24个地址的一块地址空间。 固定一个MAC地址的前24比特，让公司自己为每个适配器生成后24比特的唯一组合

当某适配器要向某些目的适配器发送一个帧时，发送适配器将目的适配器的MAC地址插入到该帧中，并将该帧发送到局域网上。

又是发送适配器要让局域网上所有其他适配器来接收并处理它打算发送的帧，这是需要在该帧的目的地址字段插入一个特殊的**MAC广播地址**（48个连续的1组成的字符串）

#### 地址解析协议

存在网络地址和链路层地址所以 需要它们之间进行转换

每台主机或路由器在其内存中具有一个ARP表，这张表包含IP地址到MAC地址的映射关系

![image-20220127135056812](https://minyeon.oss-cn-beijing.aliyuncs.com/tenglingImg/image-20220127135056812.png)

表中还有一个寿命（TTL）值，指示了从表中删除每个映射的时间

如果ARP表中没有目的主机的表项，需要发送方用ARP协议来解析这个地址。

1. 发送构造一个称为ARP分组的特殊分组。ARP查询分组的目的是询回子网上所有其他主机和路由器，以确定对应于要解析的IP地址的那个MAC地址

查询报文是广播帧发送，而响应ARP报文在一个标准帧发送

ARP即插即用，ARP表是自动建立的，即它不需要系统管理员来配置

### 以太网

集线器：一种物理层设备，直接用双绞线对铜线与一台集线器相连

交换机

![image-20220127154451986](https://minyeon.oss-cn-beijing.aliyuncs.com/tenglingImg/image-20220127154451986.png)

数据字段：以太网的最大传输单元是1500字节，最小长度是46字节 

目的地址：包含目的适配器的MAC地址

源地址：包含了传输该帧到局域网上的适配器的MAC地址

类型字段：类型字段允许以太网复用多钟网络层协议

CRC 目的是使得接收适配器检测帧中是否引入了差错

前同步码：前7个字节用于“唤醒"接收适配器，并且将它们的时钟和发送方的时钟同步。



10BASE-T  10/100这些代表速率

BASE指基带以太网，意味着该物理媒体仅承载以太网流量 

首字母缩写词的最后一部分指物理媒体本身

交换机转发分组基于MAC地址而不是基于IP地址

交换机是自学习，即插即用设备



